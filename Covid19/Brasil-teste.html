<!DOCTYPE html>

<html>

  <head>
  	<meta charset="utf-8">
    <title>Coronavirus no Piauí</title>


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>


    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"  integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

    <script type="text/javascript" src="data/brasil.js"></script>
	<link rel="stylesheet" href="css/dc.css">
	<script src="js/crossfilter.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/dc.js" charset="utf-8"></script>

	<!-- <script src="dc.js" charset="utf-8"></script> -->
	<!-- <link rel="stylesheet" href="dc.css"> -->
	<!-- <script src="crossfilter.js" charset="utf-8"></script> -->

	
    <style type="text/css">
      	#mapid { width: 80%; height: 800px;}
      	/*#chart { width: 40%; }*/
		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}

		.legend {
			text-align: left;
			line-height: 18px;
			color: #555;
		}
		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 8px;
			opacity: 0.7;
		}
    </style>

  </head>

  <body style="margin-left: 50px;">
	<h1> Mapa do Coronavirus no Brasil </h1>
	<div id="mapid"></div>
	<h5>*Atualizado em 22 de março de 2020. Fonte: <a href="https://brasil.io/dataset/covid19/caso"></a> </h5>
	
	
    <script>

    	// var dataTable = dc.dataTable("#dc-table-graph");
      	var Centro = [-15.794410, -47.883122];
      	var mymap = L.map('mapid').setView(Centro, 4.4);

      	L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {maxZoom: 18, attribution: `&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>`}).addTo(mymap);

		// date,state,city,place_type,confirmed,deaths,is_last,estimated_population_2019,city_ibge_code,confirmed_per_100k_inhabitants,death_rate


		let ConfByID = d3.map();
		let MortesByID = d3.map();
		let TotalCasos = 0;
		let TotalMortes = 0;

      	d3.csv("data/covid19br.csv", function(data){

      		data.forEach(function(d) {

      			if(d.place_type == "city"){
      				d.date = d.date;
      				
      				d.UF = d.state;
      				d.name = d.city;
      				d.IBGE = d.city_ibge_code;
      				d.pop = d.estimated_population_2019;


      				d.is_last = d.is_last;

      				d.confirmados = +d.confirmed;
      				d.mortes = +d.deaths;

      				if(d.is_last == "True"){
       					ConfByID.set(d.IBGE, +d.confirmados);
      					MortesByID.set(d.IBGE, +d.mortes); 
      					TotalCasos+= d.confirmados;
      					TotalMortes+=d.mortes;    					
      				}


      			}
      			


      		});
      		
// var escalaCores = ["#fee8c8","#fdbb84","#e34a33"];
			var Mapas = L.geoJSON(Brasil, {

				style: function(feature) {

					var ID = feature.properties.id.substr(0, 7);

					var cor = "black";
					var opc = 0;

					if(ConfByID.get(ID)){
						cor = "#fdbb84";
						opc = 1;
					}

					if(MortesByID.get(ID)){
						cor = "e34a33";
					}



				    return {
				    	color: "black",
					    weight: 0.1,
					    fillColor: cor,
					    fillOpacity: opc,
				    }
				}
			}).addTo(mymap);


		});

    </script>


  </body>
</html>